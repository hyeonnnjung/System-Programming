# System Programming project#3 - MyStockServer

**과목**: CSE4100 시스템 프로그래밍  
**학번**: 20210428  
**이름**: 정현정   

---

## 프로젝트 개요

MyStockServer 프로젝트는 다수의 클라이언트 요청을 동시에 처리할 수 있는 **Concurrent Stock Server**를 구현하여 주식 정보 조회, 구매, 판매 기능을 수행합니다. 서버는 주식 정보를 이진 탐색 트리에 저장하고, 클라이언트 요청을 **이벤트 기반** 및 **쓰레드 기반** 방식으로 처리하여 성능을 비교 분석합니다.

### 주요 기능

MyStockServer는 다음과 같은 기능을 포함합니다:
1. **이벤트 기반 서버(Event-driven Approach)**: `select()`를 이용한 I/O 멀티플렉싱으로 다수의 클라이언트 요청을 하나의 프로세스에서 관리
2. **쓰레드 기반 서버(Thread-based Approach)**: `pthread` 라이브러리를 활용한 멀티쓰레딩으로 각 요청을 별도의 워커 쓰레드가 처리
3. **성능 평가 및 비교**: 다양한 워크로드에서 이벤트 기반과 쓰레드 기반 방식의 성능을 비교 분석

---

## 프로젝트 구성

### Task 1: Event-driven Approach

- **개요**: `select()`를 사용하여 다수의 클라이언트 요청을 동시에 관리하며, I/O 멀티플렉싱을 통해 서버가 하나의 프로세스로 여러 연결을 처리
- **주요 기술**:
  - **I/O 멀티플렉싱**: `select()` 함수를 통해 다수의 파일 디스크립터를 관리하고, 클라이언트 요청에 따라 적절히 처리
  - **데이터 구조**: 주식 데이터는 이진 탐색 트리에 저장되며, 각 노드는 주식 ID, 잔여 주식, 주식 단가 등의 정보를 포함함

### Task 2: Thread-based Approach

- **개요**: 다중 쓰레드 기반의 구조로, 클라이언트 요청이 발생할 때마다 `pthread`를 이용해 워커 쓰레드가 각 요청을 병렬로 처리
- **주요 기술**:
  - **쓰레드 풀**: 미리 생성된 쓰레드 풀을 통해 새로운 쓰레드 생성에 따른 오버헤드를 줄이고, `sbuf` 버퍼를 사용하여 연결된 클라이언트를 관리
  - **Reader-Writer 문제 해결**: `mutex` 및 `readcnt`를 통해 다중 클라이언트가 동일한 주식 정보를 읽고 쓸 때 발생할 수 있는 데이터 일관성 문제를 해결

### Task 3: 성능 평가 및 분석

- **목표**: 각 접근 방식의 성능을 **동시 처리율(시간당 요청 처리 수)**로 비교 분석하여 최적의 서버 구조를 도출
- **성능 측정**:
  - 클라이언트 요청의 수와 요청 유형에 따라 서버의 동시 처리율을 측정하고 그래프로 시각화하여 비교
  - 워크로드 유형: 
    - 모든 클라이언트가 `buy` 및 `sell` 요청을 보내는 경우
    - 모든 클라이언트가 `show` 요청만 보내는 경우
    - `buy`, `sell`, `show` 요청을 혼합하여 보내는 경우

---

## 개발 환경

- **언어**: C
- **개발 및 실행 환경**: Linux (cspro 서버)
- **필요 라이브러리**: 표준 C 라이브러리, `pthread` 라이브러리

## 파일 구성 및 실행 방법

1. **컴파일**:
   각 접근 방식은 별도의 디렉토리로 구분되며, 각 디렉토리에는 `Makefile`이 포함되어 있습니다. 디렉토리 내에서 다음 명령어로 컴파일할 수 있습니다:
   ```bash
   make
   ```
2. **실행**:
   컴파일 후 `stockserver` 실행 파일이 생성되며, 해당 파일을 실행하여 서버를 시작합니다.
   ```bash
   ./stockserver [포트 번호]
   ```
3. **클라이언트 연결**:
   `stockclient` 혹은 `multiclient` 파일을 이용해 여러 클라이언트를 연결하고, 각 클라이언트에서 `show`, `buy`, `sell`, `exit` 명령어를 통해 서버에 요청을 보낼 수 있습니다.

---

## 주요 명령어

- **show**: 모든 주식의 현재 상태를 출력
- **buy [주식 ID] [개수]**: 특정 주식을 지정한 개수만큼 구매
- **sell [주식 ID] [개수]**: 특정 주식을 지정한 개수만큼 판매
- **exit**: 서버와의 연결을 종료

---

## 기타

- **Readers-Writers 문제 해결**: 쓰레드 기반 서버에서는 동시성을 높이기 위해 `mutex` 및 `semaphore`를 사용하여 문제를 해결하였습니다.
- **성능 측정 및 분석**: `gettimeofday()` 함수를 사용하여 클라이언트 요청 처리 시간과 동시 처리율을 측정하고, 각 접근 방식의 성능을 비교하였습니다.
- **Network Programming**: 기본 네트워크 연결 및 데이터 전송에는 소켓 프로그래밍 기법이 사용되었습니다.